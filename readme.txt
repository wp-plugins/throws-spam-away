=== Plugin Name ===
Contributors: taman777
Donate link: http://gti.jp/
Tags: comments, spam
Requires at least: 3.1
Tested up to: 3.5.1
Stable tag: 2.3.2

コメントに日本語が使用されていないものや任意のIPアドレスからの投稿を無視するプラグイン

== Description ==
海外からのコメントスパムに対抗（？）する手段として開発したプラグインです。

コメント欄に日本語文字列が含まれていないと投稿出来ない・・・
といってもエラーにするのではなく「無視」して何事もなかったようにもとの記事に戻ります。

ダブルバイトをカウントするのではなく正規表現により日本語を検出しているため、ダブルバイトの他言語も侵入してきません。

また、NGキーワードを複数設定することが出来ます。（カンマ区切りにて設定）
日本語の文章であっても設定された「NGキーワード」を含む投稿の場合は、同様に無視します。
もちろん他の言語のキーワードでもOKです。

日本語が一切入っていないコメントでも「NGキーワード」だけ設定したい場合を想定し
日本語が入っていないと許可しない設定を「オン・オフ」出来るようになっています。
リンクと思わしき'http'を含んだ文字列が許容数（初期設定は３つ）を超えて包含される場合にエラーとします。

以前にスパムとしてチェックした投稿のIPアドレス及び、任意のIPアドレスでの制御も出来るようになっています。
IPアドレスの指定は「,（半角カンマ）」区切りで複数入力できますが、「192.168.1.0/24」のようにIPアドレスの範囲指定も可能です。
※例：192.168.0.1,192.168.1.0/24,69.208.0.0/16 と指定した場合
　[192.168.0.1]と[192.168.1.0 ～ 192.168.1.255]と[69.208.0.0 ～ 69.208.255.255]のIPアドレスを拒否対象とします。
・バージョン2.3.1, 2.3.2 不具合修正 仕様は2.3のままです。
・バージョン2.3スパムコメント数を保持出来るようにしました。設定を変更しないと機能しませんのでご注意ください。
　保持データは下記の通り
    ○投稿日時
    ○投稿された記事ID
    ○投稿元IPアドレス
    となります。
  作成されるテーブル名は　wp_tsa_spam（wp_の部分は設定されたもの） となります。

  現在は　スパム投稿したIPの件数（ユニーク）　と　スパム投稿総数　のみ表示中・・・・StatPressのような表示にしました。
  また、現在まで「NGワード」に設定したものが　投稿者の「名前」に存在していた場合でも通っていましたが、「名前」にも効くようにしました。
  （トラックバックでも同様に名前もNGワード対象に追加しています。）

・バージョン2.2 'http'を許容数（初期設定 3）を超えて包含する場合にエラーとする機能を付けました。
　導入後すぐに機能しはじめます。制限数の増減も行えます。
　<strong>（注意！）不要な方は設定の変更でこの機能をOFFにしてください</strong>
　※インストールしただけで最大限活用できるように初期設定値を設定いたしました。日本語スパム投稿（おもにリンクを多数掲載するもの）に対抗するための追加機能です。ご理解のほど、よろしくお願いします。

・バージョン2.1.1 一部レンタルサーバー等の設定によってコメント投稿後エラーまたは白画面になってしまう不具合を修正
　※確認したレンタルサーバー（さくらレンタルサーバー）※コメント欄に独自修正を行うような特殊な条件により発生する模様

・バージョン2.1でIPアドレスの範囲指定を可能にしました。

・バージョン2.0で、WordPressのcommentsテーブルを検索し「spam」扱いとなったコメントのIPを収集しそのIPからの投稿を無視出来る機能と任意のIPアドレスからの投稿を無視出来る機能をつけました。

・バージョン1.7で、元の画面に戻ってくる際の挙動を修正しました。
　エラー画面表示の時間を「０」に設定していた場合はエラー画面を一切介さずリダイレクトするようにしました。
　０以上の場合の挙動は以前と変わらずJavaScriptで時間になったら戻ってきます。

・バージョン1.6にてNGキーワードとは逆にコレが入っていないとダメという「必須キーワード」の設定が出来るようにしました。
　日本語を入れれば良いため通ってしまいやすい「中国語」への配慮です。「が」や「の」や「は」など、日本語文章が成り立つ上で必ず使用するであろう「ひらがな」を入れることで効力が発揮されると思います。

・バージョン1.5では「トラックバック」に対しても同様の規制を入れられるようになりました。
　トラックバック記事の内容に日本語を含まないものを無視します。
　加えて、トラックバック記事内にこちらのサイトのURLが含まれない場合、日本語が含まれていても無視するかどうかの設定も出来るようにしました。


制作：佐藤　毅（さとう　たけし） <a href="http://gti.jp/" target="_blank">博多 南福岡 ホームページ制作</a> 株式会社ジーティーアイ代表

== Installation ==

インストールする場合は、ダッシュボードの「プラグイン」メニューから
「新規追加」をクリックして、「キーワード」に「Throws SPAM Away」と入力し「プラグインの検索」を行って
結果に現れた「Throws SPAM Away」をインストールしてください。

または、ダウンロードした「throws-spam-away」フォルダを
FTPなどで　/wp-content/plugins/ ディレクトリにアップロードし
「プラグイン」メニューより「Throws SPAM Away」を「有効化」してご利用ください。

e.g.

1. Upload `throws-spam-away` to the `/wp-content/plugins/` directory
2. Activate the plugin through the 'Plugins' menu in WordPress

== Frequently Asked Questions ==
質問やご要望はSupportまたは弊社お問い合わせ（http://gti.jp/）へお願いします！

== Screenshots ==

== Changelog ==
= 2.3.1, 2.3.2 =
不具合の修正をしました。ご迷惑をおかけいたしまして申し訳ありません。
テーブルに書き込まれない不具合を修正しました。

= 2.3 =
スパムコメント数を保持出来るようにしました。設定を変更しないと機能しませんのでご注意ください。
　保持データは下記の通り
    ○投稿日時
    ○投稿された記事ID
    ○投稿元IPアドレス
    となります。
  作成されるテーブル名は　wp_tsa_spam（wp_の部分は設定されたもの） となります。

  現在は　スパム投稿したIPの件数（ユニーク）　と　スパム投稿総数　のみ表示中・・・・StatPressのような表示にしました。
  また、現在まで「NGワード」に設定したものが　投稿者の「名前」に存在していた場合でも通っていましたが、「名前」にも効くようにしました。
  （トラックバックでも同様に名前もNGワード対象に追加しています。）

= 2.2 =
URL文字列（単純に'http'文字列）が許容数（初期設定３つまで）を超えて包含される場合エラーとする機能を追加
制限するかどうかと許容数の設定及びエラー文言を設定可能。

<strong>（注意！）導入後すぐに機能しはじめます。不要な方は設定の変更でこの機能をOFFにしてください</strong>
　※インストールしただけで最大限活用できるように初期設定値を設定いたしました。日本語スパム投稿（おもにリンクを多数掲載するもの）に対抗するための追加機能です。ご理解のほど、よろしくお願いします。

= 2.1.1 =
一部レンタルサーバー等の設定によってコメント投稿後エラーまたは白画面になってしまう不具合を修正
　※確認したレンタルサーバー（さくらレンタルサーバー）※コメント欄に独自修正を行うような特殊な条件により発生する模様
　これまで「comment_form」にて処理していた動作を「comment_form_after」にて処理するよう変更しました。

= 2.1 =
IPアドレスの指定に「192.168.1.0/24」のようにIPアドレス範囲指定出来るようにしました。
※例：192.168.0.1,192.168.1.0/24,69.208.0.0/16 と指定した場合
　[192.168.0.1]と[192.168.1.0 ～ 192.168.1.255]と[69.208.0.0 ～ 69.208.255.255]のIPアドレスを拒否対象とします。

= 2.0 =
下記の機能を追加しました。
・コメント投稿者のIPアドレスが以前スパム扱いとなったものと同じIPアドレスからの投稿であれば無視するようにする機能
・任意のIPアドレスからの投稿を無視するようにする機能

= 1.7 =
エラー文言画面から戻ってくる時間の設定が「0」だった場合は一切エラー画面を介さずリダイレクトするようにしました。
より「何もなかった感」があると思います。（スパム投稿者はなにが起きたかわからない・・・ではなくなにごとも起きてないと思うはず・・・）

= 1.6.1 =
日本語文字が何文字以上入っていないとNGかのしきい値とちらっと現れるエラー文言画面から元の記事に戻ってくる時間の設定が
「ミリ秒」だったのをわかりやすいように「秒」設定に変更します。

～現在、この設定をしている方へ！！！～
今までの設定値が有効の場合に１０００秒以上待つことになりかねないため変数名を変更しました。
再度設定を、「秒単位」にてお願い致します。

= 1.6 =
必須キーワードの設定ができるようにしました。※複数指定可能
これにより漢字などが入り込んでなんとか通ってきた言語に対しても「ひらがな」等の指定によりより一層厳しくチェックできるようになります。

= 1.5 =
トラックバック・ピンバックに対しても同様のチェックを行う機能をつけました。
（オン・オフ設定出来ます。）
また、その際、トラックバック記事の中に自サイトのURLが含まれているかどうかをチェックすることも出来るようにしています。
（オン・オフ設定出来ます。）
※トラックバックに対しては使用しないで従来通りご利用いただけます。
※インストール時はトラックバック記事には適用しない設定になっておりますのでご利用時には「設定」メニューより「Throws SPAM Away」をクリックしていただき
　「上記設定をトラックバック記事にも採用する」を「する」に
　「トラックバック記事にも採用する場合、ついでにこちらのURLが含まれているか判断する」を適宜　変更してご使用ください。

= 1.4.2 =
バグ修正

= 1.4.1 =
バグ修正

= 1.4 =
機能のオン・オフをつけました。
NGキーワードの設定が出来るようになりました。
日本語でも他の言語でもNGキーワードが入っていれば同様に処理するようにしました。
NGキーワードに引っかかってしまった場合のエラー文言は別途設定できます。

= 1.3 =
コメント欄下の注意文言及びエラー文言を設定可能にしました。

= 1.2.1 =
バージョン表記修正。機能は変更ありません。

= 1.2 =
設定画面を設けました。こちらで、日本語文字が何文字以上入っていないとNGかのしきい値とちらっと現れるエラー文言画面から元の記事に戻ってくる時間（ミリ秒）を設定することが出来ます。

= 1.1 =
マルチバイト文字が存在していても日本語文字列を含まないとNGとするよう
正規表現を入れて精査するように修正

= 1.0 =
新規作成

== Upgrade Notice ==
= 2.0 =
以前スパム扱いとなったコメントの投稿IPアドレスからの投稿を無視機能追加
任意IPアドレスからの投稿を無視機能追加

= 1.4 =
機能のオン・オフ設定追加
NGキーワード（日本語及びその他言語）の設定による無視機能追加

= 1.3 =
コメント欄下の注意文言及びエラー文言を設定可能にしました。

= 1.2.1 =
バージョン表記修正

= 1.2 =
日本語が1文字でも含まれると通ってしまうのを何文字以上含まれていないといけないのかを設定出来るようにしました。

= 1.1 =
正規表現を使いロシア語や他のマルチバイト文字列を使用する言語からの攻撃に対応

= 1.0 =
とりあえず作りました！
== Arbitrary section ==

== A brief Markdown Example ==
